---
title: "Ass2MSB104GRP3"
format: pdf
editor: visual
bibliography: references.bib
---

```{r}
library(modelr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(vtable)
library(flextable)
library(scales)
library(tinytex)
library(readxl)
library(stringr)
library(janitor)
library(tidyr)
library(dineq) 
library(knitr)
library(ggrepel)
```

```{r}
Populasjon <- readRDS("data/Populasjon.rds")
BNP <- readRDS("data/BNP.rds")
```

## Modellestimering 

```{r}
NUTS2_bnppi <- NUTS2_data %>%
  mutate(
    nuts2 = substr(geo, 1, 4),             # Henter ut de 4 første tegnene fra NUTS3-koden
    bnp = as.numeric(bnp),
    befolkning = as.numeric(befolkning)
  ) %>%
  group_by(nuts2, land, aar) %>%
  summarise(
    total_bnp = sum(bnp, na.rm = TRUE),       # Summer BNP (i millioner)
    total_befolkning = sum(befolkning, na.rm = TRUE)
  ) %>%
  mutate(
    bnppi = round((total_bnp * 1e6) / total_befolkning)  # BNP i hele kroner per innbygger
  ) %>%
  select(nuts2, land, aar, bnppi) %>%
  arrange(land, nuts2, aar)


```

```{r}

# Beregn GINI per NUTS2 og år
GINI_NUTS2 <- KombinertRen %>%
  group_by(nuts2, land, aar) %>%
  summarise(
    GINI_BNPPI = gini.wtd(BNPPI, weights = befolkning),
    .groups = "drop"
  ) %>%
  filter(!is.na(GINI_BNPPI) & GINI_BNPPI != 0) %>%
  arrange(land, nuts2, aar)
```

Her beregnes GINI på NUTS2 nivå utifra BNPPI på regionene på NUTS 3 nivå som tilhører de enkelte NUTS2 regionene.
Variablene som benyttes er BNP og befolkningstall på NUTS 3 region som beregner BNP per innbygger.
BNPPI på NUTS2 nivå beregnes ved å slå sammen alle NUTS3 regioner hvor de firste første tegnene i GEO koden er like.

```{r}

# Beregn vekst fra 2016 til 2017 på NUTS2 nivå
NUTS2_vekst <- NUTS2_bnppi %>%
  arrange(nuts2, aar) %>%
  group_by(nuts2, land) %>%
  mutate(
    BNPPI_vekst = (bnppi - lag(bnppi)) / lag(bnppi) * 100
  ) %>%
  filter(aar == 2017) %>%  # Kun 2017 som oppgaven spesifiserer
  select(nuts2, land, aar, BNPPI_vekst)

```

\
Her er det laget et nytt datasett, hvor den prosentvise endringen i BNPPI fra 2016 til 2017 beregnes.
Veksten blir beregnet ved å subtrahere BNPPI verdien i 2017 med 2016 verdien.
Ved å dele differansen på BNPPI verdien i 2016, kommer vi frem til vekstraten.
Formelen utfører denne beregningen på alle NUTS2 regionene.
\

```{r}
# Kombiner vekst og ulikhet på NUTS2-nivå
Model_data_2017 <- GINI_NUTS2 %>%
  filter(aar == 2017) %>%
  left_join(NUTS2_vekst, by = c("nuts2", "land", "aar")) %>%
  filter(!is.na(BNPPI_vekst), !is.na(GINI_BNPPI))
```

I funksjonen over fremkommer analysegrunnlaget som skal brukes i regresjons modellen.
Vekst er sattt som uavhengi variabel, og GINI koefisienten som avhengi variabel.
Med dette datasettet kan vi teste @lessmann2017 sin teori om at det er en sammenheng mellom økonomisk vekst of ulikhet.

```{r}
# Lineær regresjon
model <- lm(GINI_BNPPI ~ BNPPI_vekst, data = Model_data_2017)

summary(model)
```

## Diagnose av modellen

## 

```{)}
```

Som det kommer frem av regresjonsanalysens ß0 verdi er den forventede GINI verdien 0,0441 når vekst er null.
I dette datasettet kommer der frem at det er en positiv korelasjon mellom vekst og ulikhet.
ß1 har en forventing på 0,0053, som vil si at GINI koefisienten forventes å øke med denne verdien for hvert prosentpoeng BNPPI øker.

I @lessmann2017 sin tekst vil effekten man vil forvente å se på GINI koefisienten avhenge om regionen man ser på er rik eller fattig fra før.
I rikere land forventer man en negativ sammenheng mellom vekst og ulikhet, dvs at vekst fører til reduserte ulikheter mellom regioner.
Dette kommer av at i rikere land er vil i stor grad de rike regionene være såpass velstående at verdiøkningen ønskes sentrert i de områdene som er underuviklet sett i sammenheng med resten av landet.
I fattigere regioner forventer man på den andre siden å se en positiv sammenheng mellom vekst og ulikhet.
Dette kalles "kuznets" effekten.
Ettersom regresjonsanalysen ga en positiv ß1 verdi, burde det etter kuznets effekten indikere at datasettets inneholder mest regioner med lavere velstand relativt sett.
