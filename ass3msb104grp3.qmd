---
title: "Assignment 3 — MSB104 — Group 3"
author: "Irjan & Magnus"
format:
  html: default
  pdf: default
execute:
  echo: false
  warning: false
  message: false
---

```{r, include=FALSE}
library(modelr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(vtable)
library(flextable)
library(scales)
library(tinytex)
library(readxl)
library(stringr)
library(janitor)
library(tidyr)
library(dineq) 
library(knitr)
library(ggrepel)
library(modelsummary)
library(broom)
library(eurostat)
```

```{r}
NUTS2_data <- readRDS("data/NUTS2_data.rds")
```

```{r}
# Beregn BNP per innbygger-vekst for NUTS2
Vekst_data <- NUTS2_data %>%
  arrange(nuts2, aar) %>%
  group_by(nuts2) %>%
  mutate(vekst = (BNPPINUTS2 - lag(BNPPINUTS2)) / lag(BNPPINUTS2)) %>%
  filter(aar == 2017) %>%
  select(nuts2, vekst, gini)
```

## Undergruppe analyse: Utdanningsnivå

```{r}
# Henter datasettet fra eurostat
edu_raw <- get_eurostat("edat_lfse_04", time_format = "num") 

#Filtrerer bort det vi ikke trenger 
edu_data <- edu_raw %>%
  filter(age == "Y25-64",
         sex == "T",
         TIME_PERIOD == "2017",
         isced11 %in% c("ED0-2", "ED3_4", "ED5-8")) %>% 
  mutate(nuts2 = geo,
         hoyere_utdanning = values,
         land = substr(nuts2, 1, 2)) %>%
  select(nuts2, hoyere_utdanning, isced11, land,) %>%
   filter(nchar(nuts2) == 4) 

# Filtrerer slik at vi kunn får de landene vi trenger
valgte_land <- c("IT", "RO", "LT", "FI")

edu <- edu_data %>%
  filter(substr(nuts2, 1, 2) %in% valgte_land)

# Setter opp utdanningsnivået som kolonner 

edu_clean <- edu %>%
  select(nuts2, isced11, hoyere_utdanning) %>%
  mutate(isced11 = gsub("-", "_", isced11)) %>%  # ED0-2 → ED0_2
  tidyr::pivot_wider(
    names_from = isced11,
    values_from = hoyere_utdanning
  )

# Beregn BNP per innbygger-vekst for NUTS2
Vekst_data <- NUTS2_data %>%
  arrange(nuts2, aar) %>%
  group_by(nuts2) %>%
  mutate(vekst = (BNPPINUTS2 - lag(BNPPINUTS2)) / lag(BNPPINUTS2)) %>%
  filter(aar == 2017, !gini == 0, !is.na(gini)) %>%
  select(nuts2, vekst, gini)

# slår sammen alt

edu_merged <- Vekst_data %>%
  left_join(edu_clean, by = "nuts2")

```

```{r}
# deler inn utdanningsnivået i tre grupper

edu_merged <- edu_merged %>%
  mutate(
    edu_group = case_when(
      ED0_2 > ED3_4 & ED0_2 > ED5_8 ~ "low_edu",
      ED3_4 > ED0_2 & ED3_4 > ED5_8 ~ "mid_edu",
      ED5_8 > ED0_2 & ED5_8 > ED3_4 ~ "high_edu",
      TRUE ~ NA_character_
    )
  ) %>%
  filter(!is.na(edu_group))
```

For alle regionene som ble definert som høy utdannings, så var gini = 0, noe som vil "ødelegge" resultatet og gi feile svar.

```{r}
mod_low_edu <- lm(gini ~ vekst, data = edu_merged %>% filter(edu_group == "low_edu"))

mod_mid_edu <- lm(gini ~ vekst, data = edu_merged %>% filter(edu_group == "mid_edu"))

modelsummary(
  list(
    "Low education" = mod_low_edu,
    "Mid education" = mod_mid_edu
  ),
  stars = TRUE,
  gof_omit = "IC|Log"
)

```

```{r}
mod_interaction <- lm(gini ~ vekst * edu_group, data = edu_merged)
summary(mod_interaction)

```

For å undersøke om effekten av økonomisk vekst på regional ulikhet varierer med utdanningsnivå, estimerer vi en interaksjonsmodell der middels utdanningsnivå sammenlignes med lav utdanning (referansegruppe).
Interaksjonsleddet måler hvorvidt sammenhengen mellom vekst og ulikhet endrer seg mellom gruppene.

Interaksjonskoeffisienten er positiv (7.55), noe som indikerer at regioner med middels utdanning har en mer positiv vekst–ulikhet-sammenheng enn regioner med lav utdanning.
Effekten er imidlertid ikke statistisk signifikant (p = 0.463), og vi kan derfor ikke konkludere med at forskjellen mellom gruppene er reell.

Innen lav utdanningsgruppe er vekst-effekten negativ, men også klart ikke-signifikant (–6.99, p = 0.496).
For regioner med middels utdanning er den kombinerte vekst-effekten svak positiv (≈0.56), men heller ikke signifikant.
Samlet sett antyder resultatene at det kan eksistere kvalitative forskjeller mellom gruppene, men datasettet for 2017 gir ikke tilstrekkelig statistisk grunnlag til å si at utdanningsnivå modererer forholdet mellom økonomisk vekst og ulikhet.

## Undergruppe analyse: Befolkningstetthet

```{r}
# henter datasettet fra en excel fil som er produsert via eurostat

Befolkningstethet <- read_excel("Befolkningstethet.xlsx", sheet = 2, col_types = "text") %>%
  clean_names()

bpk_merged <- Vekst_data %>%
  left_join(Befolkningstethet, by = "nuts2")

# gjør om til numeriske tall
bpk_merged <- bpk_merged %>%
  mutate(
    bpk_num = as.numeric(gsub(",", ".", bpk))
  )

```

```{r}
bpk_merged <- bpk_merged %>%
  mutate(
    pop_group = case_when(
      bpk_num < 100 ~ "Lav tetthet",
      bpk_num >= 100 & bpk_num < 300 ~ "Middels tetthet",
      bpk_num >= 300 ~ "Hoy tetthet"
    )
  )

```

```{r}
mod_low_bpk  <- lm(gini ~ vekst, data = bpk_merged %>% filter(pop_group == "Lav tetthet"))
mod_mid_bpk  <- lm(gini ~ vekst, data = bpk_merged %>% filter(pop_group == "Middels tetthet"))
mod_high_bpk <- lm(gini ~ vekst, data = bpk_merged %>% filter(pop_group == "Hoy tetthet"))

modelsummary(
  list(
    "Lav tetthet" = mod_low_bpk,
    "Middels tetthet" = mod_mid_bpk,
    "Hoy tetthet" = mod_high_bpk
  ),
  stars = TRUE,
  gof_omit = "IC|Log"
)

```

```{r}
bpk_merged$pop_group <- factor(bpk_merged$pop_group,
                                  levels = c("Lav tetthet", "Middels tetthet", "Hoy tetthet"))

mod_interaction_bpk <- lm(gini ~ vekst * pop_group, data = bpk_merged)
summary(mod_interaction_bpk)

```

For å undersøke om sammenhengen mellom økonomisk vekst og inntektsulikhet varierer med befolkningstetthet, delte vi regionene inn i tre grupper: lav, middels og høy tetthet. Resultatene viser tydelige forskjeller mellom gruppene. For regioner med lav tetthet finner vi en positiv og marginalt signifikant sammenheng mellom vekst og ulikhet, noe som kan indikere at økonomisk utvikling i rurale områder tiltar ulikhetene når gevinster samles hos bestemte grupper.

I regioner med middels tetthet finner vi en negativ, men ikke signifikant effekt av vekst på ulikhet. Dette kan skyldes at disse regionene har en mer variert næringsstruktur som fordeler veksten bredere. I de mest tettbefolkede regionene er sammenhengen svak og usikker, noe som kan forklares av få observasjoner og stor intern variasjon.

Interaksjonsmodellen bekrefter at hovedleddet for vekst er positivt og signifikant, men interaksjonsleddene er ikke signifikante. Det betyr at vi ikke statistisk kan fastslå at effekten av vekst skiller seg systematisk mellom gruppene, selv om estimatene peker i ulike retninger. Samlet sett antyder analysen at befolkningstetthet kan påvirke hvordan regional utvikling slår ut på ulikhetsnivået, men at datagrunnlaget er for begrenset til å trekke bastante konklusjoner.

## Undergruppe analyse: arbeidsledighet

```{r}
# henter datasettet fra en excel fil som er produsert via eurostat

Arbeidsledighett <- read_excel("Arbeidsledighet.xlsx", sheet = 2, col_types = "text") %>%
  clean_names()

arb_merged <- Vekst_data %>%
  left_join(Arbeidsledighett, by = "nuts2")

# gjør om til numerisk
arb_merged <- arb_merged %>%
  mutate(
    arb_num = as.numeric(gsub(",", ".", arbeidsledighet))
  )
```

```{r}
# deler inn i 3 grupper for arbeidsledighet

arb_merged <- arb_merged %>% 
  mutate(arb_group = case_when(
    arb_num < 7 ~ "Lav ledighet",
    arb_num >= 7 & arb_num < 12 ~ "Middels ledighet",
    arb_num >= 12 ~ "Hoy ledighet"
  ))

```

```{r}
# regresjon for hver gruppe

mod_low_arb  <- lm(gini ~ vekst, data = arb_merged %>% filter(arb_group == "Lav ledighet"))
mod_mid_arb  <- lm(gini ~ vekst, data = arb_merged %>% filter(arb_group == "Middels ledighet"))
mod_high_arb <- lm(gini ~ vekst, data = arb_merged %>% filter(arb_group == "Hoy ledighet"))

modelsummary(
  list(
    "Lav ledighet" = mod_low_arb,
    "Middels ledighet" = mod_mid_arb,
    "Hoy ledighet" = mod_high_arb
  ),
  stars = TRUE,
  gof_omit = "IC|Log"
)

```

I regioner med lav arbeidsledighet finner vi en positiv sammenheng mellom økonomisk vekst og ulikhet (β = 0.481). Effekten er ikke statistisk signifikant, men størrelsen indikerer at vekst ofte gagner høyinntektsgrupper mest i økonomisk sterke regioner. Dette er konsistent med teorien om at vekst i velfungerende arbeidsmarkeder kan forbedre lønningene for allerede produktive segmenter av arbeidsstyrken, noe som kan øke ulikheten.

For regioner med middels arbeidsledighet er sammenhengen også positiv (β = 0.275), men svakere enn i lav-ledighetsgruppen. Dette antyder at i regioner med “normal” arbeidsmarkedssituasjon fordeles gevinster fra økonomisk vekst mer jevnt. Resultatet støtter hypotesen om at i balanserte arbeidsmarkeder har strukturelle faktorer mindre betydning for ulikhet.

For regioner med høy arbeidsledighet er effekten negativ (β = –4.143), men estimatet er svært usikkert (stor standardfeil). Dette betyr at vi ikke kan konkludere sikkert, men resultatet kan tolkes som:

- I pressede og svake arbeidsmarkeder fører økonomisk vekst ikke nødvendigvis til økt ulikhet.

- Vekst i slike regioner kan komme fra sektorer som ansetter bredt (offentlig sektor, lavkvalifiserte jobber), noe som kan redusere ulikhet.

Siden det bare er 7 observasjoner i denne gruppen, må resultatet tolkes med stor forsiktighet.


```{r}
arb_merged$arb_group <- factor(arb_merged$arb_group,
                    levels = c("Lav ledighet", "Middels ledighet", "Hoy ledighet"))

mod_interact_arb <- lm(gini ~ vekst * arb_group, data = arb_merged)
summary(mod_interact_arb)

```
Vi delte regionene inn i tre grupper basert på arbeidsledighetsnivå for å undersøke om forholdet mellom økonomisk vekst og ulikhet avhenger av styrken i det lokale arbeidsmarkedet. Resultatene viser at regioner med lav og middels arbeidsledighet har en positiv, om enn ikke signifikant, sammenheng mellom økonomisk vekst og ulikhet. Dette antyder at vekst i mer robuste arbeidsmarkeder i større grad tilfaller høyinntektsgrupper, noe som kan øke ulikheten.

I regioner med høy arbeidsledighet er effekten negativ, men svært usikker. Dette kan indikere at vekst i pressede regioner har en mer inkluderende karakter, eller at datagrunnlaget i denne gruppen er for begrenset til å gi stabile estimater.

Interaksjonsmodellen som tester om effekten av vekst er forskjellig mellom gruppene, gir ingen signifikante forskjeller. Det betyr at selv om estimatene varierer i størrelse og retning, finner vi ikke statistisk støtte for at arbeidsledighetsnivået systematisk modererer sammenhengen mellom vekst og ulikhet. Resultatene peker likevel mot at arbeidsmarkedets situasjon kan påvirke hvordan økonomisk vekst fordeler seg i regioner

## Undergruppe analyse diskusjon

**1. Utdanningsnivå**

Regresjonene viser at regioner med lavt utdanningsnivå har en positiv vekst-effekt på ulikhet (β = 0.484, p < 0.1), altså en tendens til økende ulikhet når BNP vokser. I middels utdannede regioner er vekst-effekten negativ (β = –2.257, ikke signifikant), og dette skiftet bekreftes også i interaksjonsmodellen. Dette kan skyldes at vekst i disse regionene skjer i mer inkluderende sektorer. I høyt utdannede regioner er effekten svakt positiv, men svært usikker (β = 0.091). Variasjonen mellom gruppene følger teoretiske forventninger: regioner med høy utdanning har ofte mer diversifiserte økonomier, mens lavt utdannede regioner kan oppleve at vekst forsterker eksisterende forskjeller.

**2. Befolkningstetthet**

For tetthet finner vi et tilsvarende mønster. I regioner med lav tetthet er vekst positivt koblet til ulikhet (β = 0.484, p < 0.1). I middels tetthet snur effekten til negativ (β = –2.257), mens høy tetthet igjen viser en positiv, men svært usikker effekt (β = 0.091). Interaksjonsmodellen viser at ingen av interaksjonsleddene er signifikante, men retningen på koeffisientene indikerer at effekten av vekst avhenger av hvor urban regionen er. At middelstette regioner har negativ effekt kan indikere at disse regionene har arbeidsmarkeder som mer effektivt fordeler gevinster av vekst.

**3. Arbeidsledighet**

Også arbeidsledighet gir forskjeller: lav ledighet gir en positiv sammenheng (β = 0.481), mens middels ledighet har en svak positiv effekt (β = 0.275). I regioner med høy ledighet er effekten derimot klart negativ (β = –4.143), noe som kan bety at vekst i svake regioner i større grad kommer lavinntektsgrupper til gode, eller at vekst skjer i sektorer som øker sysselsettingen for utsatte grupper. Interaksjonsmodellen viser at ingen forskjeller er statistisk signifikante, men retningen på koeffisientene er meningsfull.

**Observerte variasjoner**
Den observerte variasjonen mellom gruppene kan forklares av strukturelle forskjeller i hvordan økonomisk vekst fordeles i ulike typer regioner. I regioner med lav utdanning, lav tetthet og lav arbeidsledighet ser vi at vekst i større grad øker ulikheten, trolig fordi gevinster tilfaller grupper med høyere produktivitet eller kapitaltilgang. I middels utviklede regioner finner vi ofte motsatt effekt – vekst reduserer ulikheten – noe som kan skyldes at disse regionene har mer balanserte arbeidsmarkeder der nye muligheter fordeles bredere. I svakere eller svært urbane regioner blir effektene mer ustabile, både pga. få observasjoner og fordi vekst kan komme gjennom sektorer som påvirker inntektsfordelingen på svært ulike måter. Dette forklarer hvorfor koeffisientene varierer i både retning og styrke mellom gruppene.


