---
title: "Assignment 1 — MSB104 — Group 3"
author: "Irjan & Magnus"
format:
  html: default
  pdf: default
execute:
  echo: false
  warning: false
  message: false
---

```{r}
library(modelr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(vtable)
library(flextable)
library(scales)
library(tinytex)
library(readxl)
library(dineq)
library(janitor)
library(tidyr)
library(knitr)
```

```{r setup, include=FALSE}
Sys.setlocale("LC_ALL", "Norwegian")
```

# Part A Sub-national GDP and GDP per capita
## Data aquisition

```{r, echo=TRUE}
# Henter inn populasjons datasett fra excell
Populasjon <- read_excel("DEMO_Ass1.xlsx", sheet = 2, col_types = "text") %>%
  clean_names()

# Henter inn regional BNP datasett fra excell
BNP <- read_excel("GDP_Ass1.xlsx", sheet = 2, col_types = "text") %>%
  clean_names()

```

```{r, echo=TRUE}
# Omgjør BNP og populasjonen til langt format

PopulasjonLang <- Populasjon %>%
  pivot_longer(
    cols = starts_with("x"),
    names_to = "aar",
    values_to = "befolkning"
  ) %>%
  mutate(
    aar = as.integer(str_remove(aar, "^x")),
    befolkning = as.numeric(befolkning)
  )

BNPLang <- BNP %>%
  pivot_longer(
    cols = starts_with("x"),
    names_to = "aar",
    values_to = "BNP"
  ) %>%
  mutate(
    aar = as.integer(str_remove(aar, "^x")),
    BNP = as.numeric(BNP)
  )

```

### Kort gjennomgang av datasett og variabler

Datasette *demo_r_pjanggr3* som er hentet fra Eurostat inneholder årlige befolkningestimater på NUTS3-nivå for EU-, EFTA- og kandidatland. Variablene **values** viser totalt antall bosatte personer per 1. januar, målt i antall personer. Hver observasjon identifiseres ved regionkode(**geo**) og år (**time**), samnt kjønn (**sex**) og alder (**age**). I denne analysen benyttes kun total befolkning (**sex = T**,**age = TOTAL**), slik at dataene ikke er splittet etter kjønn eller alder.

## GDP per Capita Calculation

```{r, echo=TRUE}
# Kombinerer tabellene og filtrerer bort NA-verdiene

Kombinert <- PopulasjonLang %>%
  left_join(BNPLang, by = join_by(region, aar)) %>%
  mutate(bnp_per_innbygger = (BNP * 1e6) / befolkning)

Kombinert <- Kombinert %>%
  filter(!is.na(bnp_per_innbygger))
```
  

## Decriptive Analysis
```{r}
gdpc_sammendrag <- Kombinert %>%
  summarise(
    gjennomsnitt = mean(bnp_per_innbygger),
    median = median(bnp_per_innbygger),
    standardavvik = sd(bnp_per_innbygger),
    minimum = min(bnp_per_innbygger),
    maksimum = max(bnp_per_innbygger)
  ) %>%
  
  mutate(across(
    everything(),
    ~format(round(., 2), big.mark = " ", decimal.mark = ",")
  ))

kable(
  gdpc_sammendrag,
  caption = "Sammendrag av BNP per innbygger (2000–2023)",
  align = "c",
  digits = 2
)

```

Basert på Eurostat-dataene, er BNP per innbygger beregnet som total BNP delt på antall innbyggere i hver NUTS3-region. Datasettet dekker perioden 2000-2023 for Italia, Romania, Finland og Litauen. BNP- verdiene er målt i millioner euro og er konvertert til euro per person for å gjøre regionene sammenlignbare både mellom og innenfor landene.

Gjennomsnittlig BNP per innbygger i utvalget er **19 883 euro**, med et standardavvik på **11 386 euro**, noe som viser en tydelig variasjon i økonomisk velstand mellom regionene. Minimumsverdien er **825 euro**, mens maksimum når opp mot **66 633 euro**, som reflekterer store forskjeller mellom utviklede regioner i Italia og Finland sammenlignet med mindre utviklede områder i Romania og Litauen. Medianverdien på **20 462 euro** ligger nær gjennomsnittet, noe som indikerer en tilnærmet symmetrisk fordeling, men noen enkelte regioner med svært høyt BNP per innbygger trekker gjennomsnittet litt opp.

Over tid viser dataene en jevn vekst i BNP per innbygger i alle fire land. Finland og Italia hadde de høyeste nivåene gjennom hele perioden, mens Romania og Litauen viser sterk vekst og gradvis konvergens mot de rike landene etter 2010. Figurene nedenfor illustrerer både tidsutviklingen i gjennomsnittlig BNP per innbygger og fordelingen mellom regionene i det siste observasjonsåret, som danner grunnlaget for videre analyse av regional ulikhet i del B.



```{r}
# Gjennomsnittlig utvikling over tid

Kombinert %>%
  group_by(aar) %>%
  summarise(bnp_snitt = mean(bnp_per_innbygger, na.rm = TRUE)) %>%
  ggplot(aes(x = aar, y = bnp_snitt)) +
  geom_line(color = "#0000FF") +
  geom_point() +
  labs(
    title = "Utvikling i gjennomsnittlig BNP per innbygger (2000–2023)",
    x = "År",
    y = "Euro per person",
    caption = "Kilde: Eurostat – nama_10r_3gdp og demo_r_pjanaggr3"
  )

```

```{r, echo=TRUE}
# Fordeling per land

# Samler alle regionene basert på de 2 første bokstavene i geo variabelen for å samle alle regionene til hvert sitt land
Kombinert <- Kombinert %>%
  mutate(land = substr(geo, 1, 2))


# Beregner gjennomsnittlig BNP per innbygger per land
SnittLand <- Kombinert %>%
  group_by(land) %>%
  summarise(gjennomsnitt_bnp = mean(bnp_per_innbygger, na.rm = TRUE))

# Lager en til variabel slik at det blir enklere å lese av grafen
SnittLand <- SnittLand %>%
  mutate(
    land_navn = recode(land,
      "IT" = "Italia",
      "FI" = "Finland",
      "LT" = "Litauen",
      "RO" = "Romania"
    )
  )

ggplot(SnittLand, aes(x = land_navn, y = gjennomsnitt_bnp, fill = land_navn)) +
  geom_col(alpha = 0.8, width = 0.6) +
  geom_text(aes(label = round(gjennomsnitt_bnp, 0)), 
            vjust = -0.4, size = 3, fontface = "bold") +
  labs(
    title = "Gjennomsnittlig BNP per innbygger (2000–2023)",
    x = "Land",
    y = "BNP per innbygger (euro)"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold", size = 10)
  )

```


```{r, echo=TRUE}
library(tidyverse)
library(ggrepel)

# 1. Beregn gjennomsnitt per land og år
SnittTidLand <- Kombinert %>%
  group_by(land, aar) %>%
  summarise(
    gjennomsnitt_bnp = mean(bnp_per_innbygger, na.rm = TRUE),
    .groups = "drop"
  )

# 2. Bytt ut landkodene med fulle navn
SnittTidLand <- SnittTidLand %>%
  mutate(
    land_navn = recode(land,
      "IT" = "Italia",
      "FI" = "Finland",
      "LT" = "Litauen",
      "RO" = "Romania"
    )
  )

# 3. Finn siste observasjon for etikettplassering
etiketter <- SnittTidLand %>%
  group_by(land_navn) %>%
  filter(aar == max(aar))

# 4. Lag linjediagram med etiketter
ggplot(SnittTidLand, aes(x = aar, y = gjennomsnitt_bnp, color = land_navn)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  geom_text_repel(
    data = etiketter,
    aes(label = land_navn),
    nudge_x = 2.5,
    size = 3,
    direction = "y",
    hjust = 0,
    segment.color = NA
  ) +
  scale_x_continuous(
    breaks = seq(2000, 2023, 3)
  ) +
  scale_color_brewer(palette = "Set1") +
  labs(
    title = "Utvikling i gjennomsnittlig BNP per innbygger (2000–2023)",
    x = "År",
    y = "BNP per innbygger (euro)",
    color = NULL
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 10),
    legend.position = "none",
  )

```

# Part B: Regional Inequity

## litarture Review

• Read the paper by Lessmann & Seidel (2017). You will find a copy under Filer/pdf at the
Canvas site of the course.
‣ Give a short summary of the paper (200 – 400 words).


## Gini Coefficient Calculation

```{r}
library(tidyverse)
library(dineq)

# Lag NUTS2-kode fra NUTS3-kode (første 4 bokstaver)
Kombinert <- Kombinert %>%
  mutate(
    nuts2 = substr(geo, 1, 4),
    geo = trimws(toupper(geo))
  )


NUTS2_data <- Kombinert %>%
  group_by(geo, nuts2, aar, land) %>%
  summarise(
    bnp = sum(BNP, na.rm = TRUE),
    befolkning = sum(befolkning, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    bnp_per_innbygger = (bnp * 1e6) / befolkning
  )
```

```{r}
# oversikt over hvor mange nuts2 regioner det er i hvert land
nuts2_telling <- NUTS2_data %>%
  group_by(land) %>%
  summarise(antall_nuts2 = n_distinct(nuts2))

nuts2_telling

```

```{r}



Gini_IT <- Kombinert %>%
  filter(land == "IT", !is.na(bnp_per_innbygger), bnp_per_innbygger > 0) %>%
  group_by(nuts2, aar) %>%
  summarise(
    gini = round(gini.wtd(
      x = bnp_per_innbygger,
      weights = befolkning
    ), 4),
    .groups = "drop"
  )


ggplot(Gini_IT, aes(x = aar, y = gini, color = nuts2, group = nuts2)) +
  geom_line(linewidth = 1.2) +
  labs(
    title = "Utvikling i Gini-koeffisienter (NUTS2) – Italia",
    x = "År",
    y = "Gini-koeffisient",
    color = "NUTS2-region"
  ) +
  theme_minimal(base_size = 13) +
  theme(plot.title = element_text(face = "bold", size = 15))

```

```{r}

Gini_FI <- Kombinert %>%
  filter(land == "FI", !is.na(bnp_per_innbygger), bnp_per_innbygger > 0) %>%
  group_by(nuts2, aar) %>%
  summarise(
    gini = round(gini.wtd(
      x = bnp_per_innbygger,
      weights = befolkning
    ), 4),
    .groups = "drop"
  )

ggplot(Gini_FI, aes(x = aar, y = gini, color = nuts2, group = nuts2)) +
  geom_line(linewidth = 1.2) +
  labs(
    title = "Utvikling i Gini-koeffisienter (NUTS2) – Finland",
    x = "År",
    y = "Gini-koeffisient",
    color = "NUTS2-region"
  ) +
  theme_minimal(base_size = 13) +
  theme(plot.title = element_text(face = "bold", size = 15))

```

```{r}
Gini_RO <- Kombinert %>%
  filter(land == "RO", !is.na(bnp_per_innbygger), bnp_per_innbygger > 0) %>%
  group_by(nuts2, aar,) %>%
  summarise(
    gini = round(gini.wtd(
      x = bnp_per_innbygger,
      weights = befolkning
    ), 4),
    .groups = "drop"
  )

ggplot(Gini_RO, aes(x = aar, y = gini, color = nuts2, group = nuts2)) +
  geom_line(linewidth = 1.2) +
  labs(
    title = "Utvikling i Gini-koeffisienter (NUTS2) – Romania",
    x = "År",
    y = "Gini-koeffisient",
    color = "NUTS2-region"
  ) +
  theme_minimal(base_size = 13) +
  theme(plot.title = element_text(face = "bold", size = 15))

```


```{r}
Gini_LT <- Kombinert %>%
  filter(land == "LT", !is.na(bnp_per_innbygger), bnp_per_innbygger > 0) %>%
  group_by(nuts2, aar,) %>%
  summarise(
    gini = round(gini.wtd(
      x = bnp_per_innbygger,
      weights = befolkning
    ), 4),
    .groups = "drop"
  )

ggplot(Gini_LT, aes(x = aar, y = gini, color = nuts2, group = nuts2)) +
  geom_line(linewidth = 1.2) +
  labs(
    title = "Utvikling i Gini-koeffisienter (NUTS2) – Litauen",
    x = "År",
    y = "Gini-koeffisient",
    color = "NUTS2-region"
  ) +
  theme_minimal(base_size = 13) +
  theme(plot.title = element_text(face = "bold", size = 15))

```

```{r}
Gini_alle <- bind_rows(
  Gini_IT %>% mutate(land = "Italia"),
  Gini_FI %>% mutate(land = "Finland"),
  Gini_RO %>% mutate(land = "Romania"),
  Gini_LT %>% mutate(land = "Litauen")
)

ggplot(Gini_alle, aes(x = aar, y = gini, color = land, group = nuts2)) +
  geom_line(linewidth = 1.2) +
    scale_color_manual(
    values = c(
      "Italia" = "#CCCC00",    
      "Finland" = "#0000FF",   
      "Romania" = "#C00000",   
      "Litauen" = "#e7298a"   
    )
  ) +
  labs(
    title = "Utvikling i Gini-koeffisienter (NUTS2)",
    x = "År",
    y = "Gini-koeffisient",
    color = "Land"
  ) +
  theme_minimal(base_size = 13) +
  theme(plot.title = element_text(face = "bold", size = 15))

```
```{r}
Gini_gjennomsnitt <- Gini_alle %>%
  filter(!is.na(gini), gini > 0) %>%  # fjerner NA og 0-verdier
  group_by(land) %>%
  summarise(
    gjennomsnitt_gini = round(mean(gini, na.rm = TRUE), 4),
    sd_gini = round(sd(gini, na.rm = TRUE), 4),
    min_gini = round(min(gini, na.rm = TRUE), 4),
    max_gini = round(max(gini, na.rm = TRUE), 4),
    .groups = "drop"
  ) %>%
  arrange(desc(gjennomsnitt_gini))

kable(
  Gini_gjennomsnitt,
  caption = "Gjennomsnittlig Gini-koeffisient per land (uten 0-verdier)",
  align = "lcccc",
  digits = 4
)
```

```{r}
ggplot(Gini_gjennomsnitt, aes(x = reorder(land, gjennomsnitt_gini), y = gjennomsnitt_gini, fill = land)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = round(gjennomsnitt_gini, 3)), vjust = -0.5, size = 4) +
  scale_fill_manual(values = c(
     "Italia" = "#CCCC00",    
      "Finland" = "#0000FF",   
      "Romania" = "#C00000",   
      "Litauen" = "#e7298a"
  )) +
  labs(
    title = "Gjennomsnittlig Gini-koeffisient per land (2000–2023)",
    subtitle = "Beregnet på NUTS2-nivå, uten nullverdier",
    x = "Land",
    y = "Gjennomsnittlig Gini"
  ) +
  theme_minimal(base_size = 13) +
  theme(plot.title = element_text(face = "bold", size = 15))

```


```{r}
# Beregn gjennomsnittlig Gini per år (på tvers av alle land)
Gini_total <- Gini_alle %>%
  filter(!is.na(gini), gini > 0) %>%
  group_by(aar) %>%
  summarise(
    gjennomsnitt_gini = mean(gini, na.rm = TRUE),
    sd_gini = sd(gini, na.rm = TRUE),
    .groups = "drop"
  )

# Lag graf
ggplot(Gini_total, aes(x = aar, y = gjennomsnitt_gini)) +
  geom_line(color = "#0000FF", linewidth = 1.2) +
  geom_point(color = "#0000FF", size = 2) +
  geom_ribbon(aes(ymin = gjennomsnitt_gini - sd_gini,
                  ymax = gjennomsnitt_gini + sd_gini),
              fill = "#C27E3A", alpha = 0.15) +
  labs(
    title = "Gjennomsnittlig Gini-koeffisient over tid (alle land)",
    subtitle = "Beregnet på NUTS2-nivå (2000–2023)",
    x = "År",
    y = "Gjennomsnittlig Gini-koeffisient"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 15),
    plot.subtitle = element_text(size = 12)
  )

```

## Diskusjon

De beregnede Gini-koeffisientene for BNP per innbygger på NUTS2-nivå viser tydelige forskjeller i graden av regional ulikhet mellom landene i utvalget. Romania og Litauen har de høyeste gjennomsnittlige Gini-verdiene på henholdsvis 0,1139 og 0,1107, mens Italia (0,0510) og Finland (0,0346) viser langt lavere nivåer av regional ulikhet. Dette innebærer at de østeuropeiske landene, som i større grad har vært gjennom en overgangsøkonomi og rask omstilling etter EU-innlemmelsen, fortsatt opplever mer betydelige forskjeller i økonomisk utvikling mellom regionene sammenlignet med de mer etablerte økonomiene i Vest- og Nord-Europa.

**Romania** skiller seg ut som landet med størst regional ulikhet. Både gjennomsnittet og variasjonen (standardavvik = 0.0350) er høye, noe som indikerer store forskjeller mellom regionene og betydelig endring over tid.

















Resultatene fra analysen viser tydelige mønstre i den regionale økonomiske ulikheten mellom de fire landene. Italia og Finland, som begge har modne og diversifiserte økonomier, viser lave og stabile Gini-koeffisienter. Dette indikerer at at inntektsnivået mellom regionen er relativt balansert, og at den økonomiske veksten har vært jevnt fordelt. Italia har likevel små, men medvarende forskjeller mellom nord og sør, noe som gjenspeiles i at enkelte NUTS2-regioner ligger over landsgjennomsnittet.

Romania og Litauen viser derimot høyere Gini-koeffisienter, som peker på større regionale forskjeller. i Romania skyldes dette i stor grad forskjellen mellom hovedstadregionen Bucuresti-Ilfov og de litt mer landlige regionene. Litauen viser et lignende mønster, med rask vekst i Vilnius-regionen sammenlignet med de sørlige og østlige områdene.

Over tid ser vi altså en økende konvergens mellom landene, men fortsatt betydelig intern ulikhet i de nye EU-medlemmene. Denne utviklingen kan 




















