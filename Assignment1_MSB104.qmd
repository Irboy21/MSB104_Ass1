---
title: "Assignment 1 — MSB104 — Group 3"
author: "Irjan & Magnus"
format:
  html: default
  pdf: default
execute:
  echo: false
  warning: false
  message: false
---

```{r}
library(modelr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(vtable)
library(flextable)
library(scales)
library(tinytex)
library(readxl)
library(stringr)
library(janitor)
library(tidyr)
library(dineq) 
library(knitr)
library(ggrepel)
```

```{r setup, include=FALSE}
Sys.setlocale("LC_ALL", "Norwegian")
```

# Del A: Regional BNP og BNP per innbygger

## Innhenting av data

```{r, echo=TRUE}
# Henter inn populasjons datasett fra excell
Populasjon <- read_excel("DEMO_Ass1.xlsx", sheet = 2, col_types = "text") %>%
  clean_names()

# Henter inn regional BNP datasett fra excell
BNP <- read_excel("GDP_Ass1.xlsx", sheet = 2, col_types = "text") %>%
  clean_names()

```

```{r, echo=TRUE}
# Omgjør Populasjonen til langt format

PopulasjonLang <- Populasjon %>%
  pivot_longer(
    cols = starts_with("x"),
    names_to = "aar",
    values_to = "befolkning"
  ) %>%
  mutate(
    aar = as.integer(str_remove(aar, "^x")),
    befolkning = as.numeric(str_replace_all(befolkning, " ", ""))
  )

# Omgjør BNP til langt format

BNPLang <- BNP %>%
  pivot_longer(
    cols = starts_with("x"),
    names_to = "aar",
    values_to = "BNP"
  ) %>%
  mutate(
    aar = as.integer(str_remove(aar, "^x")),
    BNP = as.numeric(str_replace_all(BNP, " ", ""))
  )
```

### Kort gjennomgang av datasett og variabler

Datasette *demo_r_pjanggr3* som er hentet fra Eurostat inneholder årlige befolkningestimater på NUTS3-nivå for EU-, EFTA- og kandidatland.
Variablene **values** viser totalt antall bosatte personer per 1.
januar, målt i antall personer.
Hver observasjon identifiseres ved regionkode(**geo**) og år (**time**), samnt kjønn (**sex**) og alder (**age**).
I denne analysen benyttes kun total befolkning (**sex = T**,**age = TOTAL**), slik at dataene ikke er splittet etter kjønn eller alder.

Det finnes ulike hoved metoder å beregne brytto nasjonalt produkt på.
Eurostat har valgt å benytte den såkalte «inntekstmetoden».
Eurostat velger denne metoden ovenfor utgifts metoden grunnet mangel på data over gode overføringer mellom regioner.

Etter inntektsmetoden regnes BNP på følgende måte: Lønn som utbetales til ansatte + bedrifter sin fortjeneste + skatte og avgifter minus subsidier gitt fra staten + avskrivinger knyttet til industri.

## BNP per innbygger

```{r}
# Beregne BNP per innbygger(BNPPI) og ganger ut BNP som er oppgitt i millioner 

Kombinert <- PopulasjonLang %>% 
left_join(BNPLang, by = join_by(region, aar)) %>%
mutate( befolkning = as.numeric(befolkning), 
BNP = as.numeric(BNP), 
BNPPI = (BNP * 1e6) / befolkning, )

```

```{r}
# Fjerner alle regioner med NA verdier

KombinertRen <- Kombinert %>%
  filter(!is.na(BNPPI))
```

```{r}
n_total <- nrow(Kombinert)

Kombinert %>%
  summarise(across(everything(), ~ sum(is.na(.x)))) %>%
  mutate(n = n_total) %>%
  select(n, everything()) %>%
  kable(
    caption = "Antall observasjoner (n) og NA-verdier per variabel",
    align = c("c", rep("r", ncol(Kombinert)))
  )

```

I tabellene over har vi kombinert de to datasettene hentet fra Eurostat.
Vi har da en tabell som viser BNP per innbygger i hvert av NUTS3 områdene for delt på år.
I hver observasjon hvor det forekommer en NA verdi i populasjon og eller total BNP vil også få BNPPI som NA verdi.
Datasettet består av totalt 4680 observasjoner, og 841 av dem ender opp ned NA verdi i BNPPI.
For å videre kunne jobbe mer effektivt i utarbeidelsen av tabellene, lager vi et nytt datasett hvor alle observasjoner med NA verdi er fjernet.

```{r}

KombinertRen %>%
  mutate(
    aar = as.numeric(aar),
    BNPPI = as.numeric(BNPPI)
  ) %>% 
  group_by(aar) %>%  
  summarise(
    gjennomsnitt_BNPPI = mean(BNPPI),
    median_BNPPI       = median(BNPPI),
    minste_BNPPI       = min(BNPPI),
    største_BNPPI      = max(BNPPI)
  ) %>%
  arrange(aar) %>%
  mutate(across(
    gjennomsnitt_BNPPI:største_BNPPI,
    ~ label_number(big.mark = " ")(.)
  )) %>%
kable(
    caption = "Utvikling i BNP per innbygger (gjennomsnitt, median, minimum og maksimum) per år",
    align = c("c", "r", "r", "r", "r"),
    col.names = c("År", "Gjennomsnitt BNPPI", "Median BNPPI", "Minste BNPPI", "Største BNPPI")
  )

```

I tabellen over ser vi utviklingen av gjennomsnitt, median, minste og høyeste verdi for BNP per inbygger for fra år 2000 til år 2023.
Verdiene er basert på alle observasjonene fra datasettet hvor observasjoner med NA verdier er fjernet.
Videre skal vi lage en deskriptiv analyse utifra statistikken som fremkommer av datasettet.
For å enklere visualisere dette lager vi linediagrammer for sentrale mål.

```{r}
#Lager et linjediagram som viser utvikling av mean og median BNPPI
KombinertRen %>%
  group_by(aar) %>% 
  summarise(
    Gjennomsnitt = mean(BNPPI, na.rm = TRUE),
    Median = median(BNPPI, na.rm = TRUE)
  ) %>%
  pivot_longer(
    cols = c(Gjennomsnitt, Median),
    names_to = "Statistikk",
    values_to = "BNPPI_verdi"
  ) %>%
  ggplot(aes(x = aar, y = BNPPI_verdi, color = Statistikk)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  labs(
    title = "Utvikling i BNP per innbygger (gjennomsnitt og median)",
    x = "År",
    y = "BNP per innbygger (BNPPI)",
    color = "Statistikk"
  ) +
  scale_color_manual(values = c("Gjennomsnitt" = "#2E86AB", "Median" = "#A93226")) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5, size = 10),
    panel.grid.minor = element_blank()
  )
  
```

```{r}
# 1. Beregn gjennomsnitt per land og år
KombinertRen <- KombinertRen %>%
  mutate(
    land = substr( geo, 1, 2)
  )
SnittTidLand <- KombinertRen %>%
  group_by(land, aar) %>%
  summarise(
    gjennomsnitt_bnp = mean(BNPPI, na.rm = TRUE),
    .groups = "drop"
  )

# 2. Bytt ut landkodene med fulle navn
SnittTidLand <- SnittTidLand %>%
  mutate(
    land_navn = recode(land,
      "IT" = "Italia",
      "FI" = "Finland",
      "LT" = "Litauen",
      "RO" = "Romania"
    )
  )

# 3. Finn siste observasjon for etikettplassering
etiketter <- SnittTidLand %>%
  group_by(land_navn) %>%
  filter(aar == max(aar))

# 4. Lag linjediagram med etiketter
ggplot(SnittTidLand, aes(x = aar, y = gjennomsnitt_bnp, color = land_navn)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  geom_text_repel(
    data = etiketter,
    aes(label = land_navn),
    nudge_x = 2.5,
    size = 3,
    direction = "y",
    hjust = 0,
    segment.color = NA
  ) +
  scale_x_continuous(
    breaks = seq(2000, 2023, 3)
  ) +
  scale_color_brewer(palette = "Set1") +
  labs(
    title = "Utvikling i gjennomsnittlig BNP per innbygger (2000–2023)",
    x = "År",
    y = "BNP per innbygger (euro)",
    color = NULL
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 10),
    legend.position = "none",
  )

```

I tabellene over ser vi utviklingen av gjennomsnitt og median verdien fra år 2000 til 2023.
Begge de statistiske målene følger i stor grad samme utvikling.
Det er en stor økning fra 2000 til 2001.
Etter dette er det i hovedsak en jevn generelt vekst fra år til år, med et par avvik.
I både 2008 og 2020 ser vi reduksjon i BNPPI sammenlignet med det forekommende året.
I 2023 ser vi igjen en drastisk endring, spesielt i Median hvor BNPPI reduseres fra ca 25 000 dollar til ca 15 000 dollar.
Reduksjonen i år 2008 og 2020 er ikke overraskende og kan forklares med henholdsvis finanskrisen og Covid-19.

En annen faktor som kan påvirke utviklingen av BNPPI er utartingen av NA verdier i data settet vårt.
Som tidligere vist er det totalt 841 observasjoner som ikke kommer med i denne tabellen.
I hvilken år disse fremkommer og hvilken NUTS3 regioner som forsvinner fra disse årene kan forventes å ha en effekt på gjennomsnittet for det året.
Dette kommer av at noen land generelt sett har høyere BNP enn andre.

```{r}
#Sjekke hvor mange observasjoner det er og hvor mange som inneholder NA verdier per år
Kombinert %>%
  group_by(aar) %>%
  summarise(
    antall_NA = sum(is.na(BNPPI)),
    total_obs = n()
  ) %>%
  arrange(aar) %>%
  kable() %>%
  kable_styling(full_width = FALSE, position = "left")
```

I denne tabellen ser vi at i BNPPI datasettet er det 140 observasjoner fra 2000 og 124 fra 2023 som har NA verdier.
Dette skiller seg ut fra årene i mellom hvor det jevnt gjennom er 26 observasjoner med NA verdi.
Totalt er det 195 observasjoner hvert år.
En teori som kan forklare at median og gjennomsnittsverdiene er veldig lave i forhold er at NUTS3 regioner med NA verdier i disse årstallene i hovedsak stammer fra land med relativt høyest BNPPI.

# Del B: Regional ulikhet

## Oppsumering av artikkel

I 2017 publiserte Christian Lessmann og Andre Seidel en artikkel hvor de ser på hvor godt egnet «lysdata» er til å estimere regional inntekt.
Sentrale spørsmål som tas opp i artikkelen er hvordan regionale økonomiske ulikheter utvikler seg over tid, og hvilke faktorer som fører til endringer i regional ulikhet.
 

I en 2012 artikkel som Lessmann og Seidel er inspirert av presenteres ideen om at «lysdata» er en indikasjon på hvor økonomisk utviklet et land er.
Tankegangen er at aktiviteter som koster penger å gjennomføre på kvelden som regel trenger lys, og jo rikere et land/ region er jo flere har råd til å delta på slike aktiviteter.
Ved å analysere satellitt bilder på nattestid kan mengden lys være en indikator på velstanden i området.

Nytteverdien fra denne vinklingen kommer av at det er stor variasjon på hvor dokumentert regionale ulikheter er fra land til land.
Artikkelen påpeker at tidligere studier på området fokuserer på vel- utviklede nasjoner, da det ikke finnes tilgjengelige gode nok data for mindre utviklete land på regionalt nivå.
Dersom det kan bevises at dette konseptet holder vann får forskere enn ny måte å analysere mindre velstående land sin regionale ulikhet.

For å undersøke hvor valid teorien er, analyserer artikkelen først velstående land hvor det allerede finnes godt dekkende data over regionale ulikheter.
Ved å analysere bilder fra NASA satellitter og rangere regioner fra 1992 og utover, skaper de estimater over hvor mye økonomisk utvikling regioner har hatt i perioden.

I studien brukes Gini-koeffisient.
Dette er et mål som måler hvor skjevt ressurser i en befolkning fordeles, for eksempel mellom regioner.
Gini-koeffisient har en skala fra 0 til 1.
En 0-verdi betyr at alt er likt fordelt, og 1 betyr at alle ressursene ligger hos en eller et veldig få antall personer.
I studien beregnes og måles koeffisienten i regioner over tid, som viser om det er divergens eller konvergens.
Dersom koeffisient øker over tid vil det si at forskjellene mellom de rike og fattige øker over tid, og det er divergens.
Hvis koeffisienten reduseres over tid reduseres forskjellen mellom rik og fattige, dvs konvergens.

Ved å sammenligne estimatene med faktiske BNP data kommer det frem at teorien i stor grad stemmer overens i middels rike og rike land, mens i fattigere land man har data på er konseptet dårlig egnet.
 

## Beregne Gini-koeffisient på vårt datasett

Videre i oppgaven skal vi beregne Gini-koeffisienten på NUTS2 nivå for landene Italia, Finland, Romania og Litauen.
Første steg er å transformere KombinertRen datasettet våres for NUTS3 regioner til en oversikt over NUTS2 regioner.
Hver NUTS3 region har en tilhørende "geo" kode.
Disse består av 5 tegn, for eksempel ITC31 for Imperia.
De fire første symbolene er det samme som NUTS 2 geo koden.
Ved å samle alle observasjoner hvor de første første symbolene er like kan vi lage en datasett fordelt på NUTS 2 regioner.

```{r}
# Lag NUTS2-kode fra NUTS3-kode (første 4 bokstaver)
KombinertRen <- KombinertRen %>%
  mutate(
    nuts2 = substr(geo, 1, 4),
    geo = trimws(toupper(geo))
  )

NUTS2_data <- KombinertRen %>%
  group_by(geo, nuts2, aar, land) %>%
  summarise(
    bnp = sum(BNP, na.rm = TRUE),
    befolkning = sum(befolkning, na.rm = TRUE),
    .groups = "drop"
  )
```

```{r}
# oversikt over hvor mange nuts2 regioner det er i hvert land
nuts2_telling <- NUTS2_data %>%
  group_by(land) %>%
  summarise(antall_nuts2 = n_distinct(nuts2))

nuts2_telling %>%
  kable(
    caption = "Antall NUTS2-regioner per land",
    align = c("l", "r")
  )
```

I datasettet er det tilsammen 36 NUTS2 regioner, men hvilken land disse faller innenfor er ganske skjevfordelt.
Det er 21 NUTS2 regioner fra Italia, mens Litauen har 2.
Finland og Romania har henholdsvis 5 og 8 NUTS2 regioner.

```{r}
Gini_IT <- KombinertRen %>%
  filter(land == "IT", !is.na(BNPPI), BNPPI > 0) %>%
  group_by(nuts2, aar) %>%
  summarise(
    gini = round(gini.wtd(
      x = BNPPI,
      weights = befolkning
    ), 4),
    .groups = "drop"
  )

ggplot(Gini_IT, aes(x = aar, y = gini, color = nuts2, group = nuts2)) +
  geom_line(linewidth = 1.2) +
  labs(
    title = "Utvikling i Gini-koeffisienter (NUTS2) – Italia",
    x = "År",
    y = "Gini-koeffisient",
    color = "NUTS2-region"
  ) +
  theme_minimal(base_size = 10) +
  theme(
    legend.position = "right",
    legend.title = element_text(face = "bold"),
    plot.title = element_text(face = "bold", size = 12),
    plot.subtitle = element_text(size = 10),
    panel.grid.minor = element_blank()
  )
```

Regionene ITC 4 og ITG2 skiller seg ut her da de gjennom hele rekken har en koeffisient mellom 0,10 og 0,17.
Dette tyder på at i disse regionene er det en større skjevfordeling av BNPPI enn i resten av landet.
I en gjennomsnittsberegning av den gjennomsnittlige Koeffisienten per år ligger den på rundt 0,05.

```{r}
Gini_FI <- KombinertRen %>%
  filter(land == "FI", !is.na(BNPPI), BNPPI > 0) %>%
  group_by(nuts2, aar) %>%
  summarise(
    gini = round(gini.wtd(
      x = BNPPI,
      weights = befolkning
    ), 4),
    .groups = "drop"
  )

ggplot(Gini_FI, aes(x = aar, y = gini, color = nuts2, group = nuts2)) +
  geom_line(linewidth = 1.2) +
  labs(
    title = "Utvikling i Gini-koeffisienter (NUTS2) – Finland",
    x = "År",
    y = "Gini-koeffisient",
    color = "NUTS2-region"
  ) +
  theme_minimal(base_size = 10) +
  theme(plot.title = element_text(face = "bold", size = 12))

```

Tabellen over viser Gini-koeffisienten for regionene i Finland.
Vi ser at to av regionene ikke vises eller er på null, dette skyldes at det ikke er noe data fra disse regionene.
I grafen ser vi at ulikheten mellom regionene synker gradvis fra rundt 2005 til 2020, noe som tyder på økende økonomisk konvergens mellom regionene.
Mot slutten ser vi en svak økning i ulikhet, og en ny region dukker opp med verdier kun fra 2023, noe som forklarer den brå linjen helt til høyre i figuren

```{r}
Gini_RO <- KombinertRen %>%
  filter(land == "RO", !is.na(BNPPI), BNPPI > 0) %>%
  group_by(nuts2, aar,) %>%
  summarise(
    gini = round(gini.wtd(
      x = BNPPI,
      weights = befolkning
    ), 4),
    .groups = "drop"
  )

ggplot(Gini_RO, aes(x = aar, y = gini, color = nuts2, group = nuts2)) +
  geom_line(linewidth = 1.2) +
  labs(
    title = "Utvikling i Gini-koeffisienter (NUTS2) – Romania",
    x = "År",
    y = "Gini-koeffisient",
    color = "NUTS2-region"
  ) +
  theme_minimal(base_size = 10) +
  theme(plot.title = element_text(face = "bold", size = 12))

```

Romaina viser et større sprik i fordelingen av Gini koeffisienten enn Italia.
Gjennomsnittet ligger på 0,11, mens majoriteten av NUTS2 regionene faller innenfor intervallet 0,6 til 0,17.
 Blant de fire landene vi analyserer har Romania den største variasjonen i hvor jevn BNPPI er fordelt mellom NUTS3 basert på tilhørende NUTS2 region.

```{r}
Gini_LT <- KombinertRen %>%
  filter(land == "LT", !is.na(BNPPI), BNPPI > 0) %>%
  group_by(nuts2, aar,) %>%
  summarise(
    gini = round(gini.wtd(
      x = BNPPI,
      weights = befolkning
    ), 4),
    .groups = "drop"
  )

ggplot(Gini_LT, aes(x = aar, y = gini, color = nuts2, group = nuts2)) +
  geom_line(linewidth = 1.2) +
  labs(
    title = "Utvikling i Gini-koeffisienter (NUTS2) – Litauen",
    x = "År",
    y = "Gini-koeffisient",
    color = "NUTS2-region"
  ) +
  theme_minimal(base_size = 10) +
  theme(plot.title = element_text(face = "bold", size = 12))

```

Litauen består av to NUTS 2 regioner.
LT01 består av bare en NUTS3 region, og det er ikke mulig å beregne en GINI koeffisient i regionen.
LT01 viser gjennom tidsrekken en økende trend.
Dette tyder på at de to siste tiårene har det oppstått en større skjevfordeling av ressurser mellom NUTS3 regionene tilhørerne LT01.
Regionen har ca.
en dobbelt så stor Koeffisient som Italia sitt gjennomsnitt, men skjevfordelingen er lavere enn Italias region med høyest koeffisient.

```{r}
Gini_alle <- bind_rows(
  Gini_IT %>% mutate(land = "Italia"),
  Gini_FI %>% mutate(land = "Finland"),
  Gini_RO %>% mutate(land = "Romania"),
  Gini_LT %>% mutate(land = "Litauen")
)

ggplot(Gini_alle, aes(x = aar, y = gini, color = land, group = nuts2)) +
  geom_line(linewidth = 1.2) +
    scale_color_manual(
    values = c(
      "Italia" = "#CCCC00",    
      "Finland" = "#0000FF",   
      "Romania" = "#C00000",   
      "Litauen" = "#e7298a"   
    )
  ) +
  labs(
    title = "Utvikling i Gini-koeffisienter (NUTS2)",
    x = "År",
    y = "Gini-koeffisient",
    color = "Land"
  ) +
  theme_minimal(base_size = 13) +
  theme(plot.title = element_text(face = "bold", size = 15))

```

Grafen viser utviklingen i Gini-koeffisienten på NUTS2-nivå for Italia, Finland, Romania og Litauen.
Romania (rød) har gjennom hele perioden de høyeste verdiene, med tydelige svingninger som indikerer store økonomiske forskjeller mellom regionene.
Italia (gul) har også relativt høye og varierende verdier, men generelt lavere enn Romania.
Litauen (rosa) ligger stabilt midt i feltet med moderat ulikhet, mens Finland (blå) har de laveste og mest stabile Gini-verdiene over tid.
Samlet sett viser grafen at regionale ulikheter er størst i Romania og minst i Finland, mens Italia og Litauen ligger mellom disse ytterpunktene.

```{r}
Gini_gjennomsnitt <- Gini_alle %>%
  filter(!is.na(gini), gini > 0) %>%  # fjerner NA og 0-verdier
  group_by(land) %>%
  summarise(
    gjennomsnitt_gini = round(mean(gini, na.rm = TRUE), 4),
    sd_gini = round(sd(gini, na.rm = TRUE), 4),
    min_gini = round(min(gini, na.rm = TRUE), 4),
    max_gini = round(max(gini, na.rm = TRUE), 4),
    .groups = "drop"
  ) %>%
  arrange(desc(gjennomsnitt_gini))

kable(
  Gini_gjennomsnitt,
  caption = "Gjennomsnittlig Gini-koeffisient per land (uten 0-verdier)",
  align = "lcccc",
  digits = 4
)
```

```{r}
ggplot(Gini_gjennomsnitt, aes(x = reorder(land, gjennomsnitt_gini), y = gjennomsnitt_gini, fill = land)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = round(gjennomsnitt_gini, 3)), vjust = -0.5, size = 4) +
  scale_fill_manual(values = c(
     "Italia" = "#CCCC00",    
      "Finland" = "#0000FF",   
      "Romania" = "#C00000",   
      "Litauen" = "#e7298a"
  )) +
  labs(
    title = "Gjennomsnittlig Gini-koeffisient per land (2000–2023)",
    subtitle = "Beregnet på NUTS2-nivå, uten nullverdier",
    x = "Land",
    y = "Gjennomsnittlig Gini"
  ) +
  theme_minimal(base_size = 10) +
  theme(plot.title = element_text(face = "bold", size = 12)) +
  expand_limits(y = max(Gini_gjennomsnitt$gjennomsnitt_gini) + 0.01)

```

```{r}
# Beregn gjennomsnittlig Gini per år (på tvers av alle land)
Gini_total <- Gini_alle %>%
  filter(!is.na(gini), gini > 0) %>%
  group_by(aar) %>%
  summarise(
    gjennomsnitt_gini = mean(gini, na.rm = TRUE),
    sd_gini = sd(gini, na.rm = TRUE),
    .groups = "drop"
  )

# Lag graf
ggplot(Gini_total, aes(x = aar, y = gjennomsnitt_gini)) +
  geom_line(color = "#0000FF", linewidth = 1.2) +
  geom_point(color = "#0000FF", size = 2) +
  geom_ribbon(aes(ymin = gjennomsnitt_gini - sd_gini,
                  ymax = gjennomsnitt_gini + sd_gini),
              fill = "#C27E3A", alpha = 0.15) +
  labs(
    title = "Gjennomsnittlig Gini-koeffisient over tid (alle land)",
    subtitle = "Beregnet på NUTS2-nivå (2000–2023)",
    x = "År",
    y = "Gjennomsnittlig Gini-koeffisient"
  ) +
  theme_minimal(base_size = 10) +
  theme(
    plot.title = element_text(face = "bold", size = 12),
    panel.grid.minor = element_blank()
  )
```

I tabellen over ser vi GINI koeffisienten for alle NUTS2 regionene som tilhører vårt datasett.
GINI verdien beskriver hvor jevn fordelt BNPPI er fordelt mellom NUTS3 regionene som havner i samme NUTS2 region.
Koeffisienten ligger i mellom 0,02 og 0,11 for majoriteten av regionene gjennom hele årrekken.
Dette indikerer at i hver enkelt NUTS2 region er det en jevn fordeling av BNPPI i de tilhørende NUTS3 regionene.

```{r}
# Lag NUTS1-kode fra NUTS3-kode (første 2 bokstaver)
KombinertRen <- KombinertRen %>%
  mutate(
    nuts1 = substr(geo, 1, 2),
    geo = trimws(toupper(geo))
  )

NUTS1_data <- KombinertRen %>%
  group_by(geo, nuts1, aar, land) %>%
  summarise(
    bnp = sum(BNP, na.rm = TRUE),
    befolkning = sum(befolkning, na.rm = TRUE),
    .groups = "drop"
  )
```

```{r}
Gini_FI_NUTS1 <- KombinertRen %>%
  filter(land == "FI", !is.na(BNPPI), BNPPI > 0) %>%
  group_by(nuts1, aar) %>%
  summarise(
    gini = round(gini.wtd(
      x = BNPPI,
      weights = befolkning
    ), 4),
    .groups = "drop"
  )

Gini_IT_NUTS1 <- KombinertRen %>%
  filter(land == "IT", !is.na(BNPPI), BNPPI > 0) %>%
  group_by(nuts1, aar) %>%
  summarise(
    gini = round(gini.wtd(
      x = BNPPI,
      weights = befolkning
    ), 4),
    .groups = "drop"
  )

Gini_RO_NUTS1 <- KombinertRen %>%
  filter(land == "RO", !is.na(BNPPI), BNPPI > 0) %>%
  group_by(nuts1, aar) %>%
  summarise(
    gini = round(gini.wtd(
      x = BNPPI,
      weights = befolkning
    ), 4),
    .groups = "drop"
  )

Gini_LT_NUTS1 <- KombinertRen %>%
  filter(land == "LT", !is.na(BNPPI), BNPPI > 0) %>%
  group_by(nuts1, aar) %>%
  summarise(
    gini = round(gini.wtd(
      x = BNPPI,
      weights = befolkning
    ), 4),
    .groups = "drop"
  )

Gini_alle_NUTS1 <- bind_rows(
  Gini_IT_NUTS1 %>% mutate(land = "Italia"),
  Gini_FI_NUTS1 %>% mutate(land = "Finland"),
  Gini_RO_NUTS1 %>% mutate(land = "Romania"),
  Gini_LT_NUTS1 %>% mutate(land = "Litauen")
)

ggplot(Gini_alle_NUTS1, aes(x = aar, y = gini, color = land, group = nuts1)) +
  geom_line(linewidth = 1.2) +
    scale_color_manual(
    values = c(
      "Italia" = "#CCCC00",    
      "Finland" = "#0000FF",   
      "Romania" = "#C00000",   
      "Litauen" = "#e7298a"   
    )
  ) +
  labs(
    title = "Utvikling i Gini-koeffisienter (NUTS2)",
    x = "År",
    y = "Gini-koeffisient",
    color = "Land"
  ) +
  theme_minimal(base_size = 13) +
  theme(plot.title = element_text(face = "bold", size = 15))
```

Her er det laget et linjediagram som viser utviklingen av GINI koeffisient på NUTS1-nivå (Land) basert på fordelingen av BNPPI i NUTS2 regionene. Koeffisientene sier noe om fordelingen av BNPPI mellom NUTS2 regioner sett opp mot hele landet. Vi ser at Italia sin koeffisienten ligger mellom 0,17 og 0,19. Dette indikerer at det i Italia er en større skjevfordeling mellom NUTS2 regionene, enn det er i NUTS3 regionene satt opp mot regioner i samme NUTS2.

## Diskusjon

De beregnede Gini-koeffisientene for BNP per innbygger på NUTS2-nivå viser tydelige forskjeller i graden av regional ulikhet mellom landene i utvalget.
Romania og Litauen har de høyeste gjennomsnittlige Gini-verdiene på henholdsvis 0,1139 og 0,1107, mens Italia (0,0510) og Finland (0,0346) viser langt lavere nivåer av regional ulikhet.
Dette innebærer at de østeuropeiske landene, som i større grad har vært gjennom en overgangsøkonomi og rask omstilling etter EU-innlemmelsen, fortsatt opplever mer betydelige forskjeller i økonomisk utvikling mellom regionene sammenlignet med de mer etablerte økonomiene i Vest- og Nord-Europa.

Samlet sett viser tidsserien for Gini-koeffisientene på NUTS2-nivå at de fleste landene opplever svak økning i ulikhet etter 2010, noe som sammenfaller med finanskrisen og senere perioder med økonomisk omstilling. Øst-Europa (spesielt Romania og Litauen) viser tegn til økonomisk konvergens på nasjonalt nivå, men ikke nødvendigvis på regionalt nivå – de rikeste regionene vokser fortsatt raskere enn resten.

Når det gjelder regionale ulikheter, indikerer resultatene at økonomisk vekst i EU ikke har vært likt fordelt. Land som Finland har klart å opprettholde en jevn fordeling, mens andre land, særlig Romania, som vi ser har en store variasjoner i hvor jevnt fordelt BNPPI-er fra region til region.

## Del C: Dokumentasjon av AI

Vi har benyttet chatGTP modell 4.1 og 5 gjennom denne oppgaven. Først har vi benyttet AI til å tolke og forstå oppgaveteksten samt gitt oss et utgangspunkt til hvor vi skal starte med behandlingen av eurostat dataene. Videre har vi benyttet AI til å finne/løse feil i kodene. Ledeteksten vi har benyttet er å gi oppgaveteksten og pensum til chatGPT. Dette ga oss flere ideer om ulike modeller som vi har benyttet i denne oppgaven.

