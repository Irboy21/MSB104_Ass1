---
title: "Assignment 1"
format: html
editor: visual
---

## 

```{r}
library(modelr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(vtable)
library(flextable)
library(scales)
library(tinytex)
library(readxl)
library(stringr)
library(janitor)
library(tidyr)
library(dineq)
```

```{r}
Sys.setlocale("LC_ALL", "Norwegian")
```

```{r}

# Henter inn populasjons datasett fra Excel
Populasjon <- read_excel("DEMO_Ass1.xlsx", sheet = 2, col_types = "text") %>%
  clean_names()

# Henter inn regional BNP datasett fra Excell 
BNP <- read_excel("GDP_Ass1.xlsx", sheet = 2, col_types = "text") %>%
  clean_names()


```

```{r}

# Omgjør populasjon til langt format 
PopulasjonLang <- Populasjon %>%
  pivot_longer(
    cols = starts_with("x"),
    names_to = "Aar",
    values_to = "Innbyggere"
  ) %>%
  mutate(
    Aar = as.integer(str_remove(Aar, "^x")),
    Innbyggere = as.numeric(str_replace_all(Innbyggere, " ", ""))
  )


```

```{r}

#Omgjør BNP til langt format

BNPLang <- BNP %>%
  pivot_longer(
    cols = starts_with("x"),
    names_to = "Aar",
    values_to = "BNP"
  ) %>%
  mutate(
    Aar = as.integer(str_remove(Aar, "^x")),
    BNP = as.numeric(str_replace_all(BNP, " ", ""))
  )
```

## Metadata BNP

Det finnes ulike hoved metoder å beregne brytto nasjonalt produkt på.
Eurostat har valgt å benytte den såkalte «inntekstmetoden».
Eurostat velger denne metoden ovenfor utgifts metoden grunnet mangel på data over gode overføringer mellom regioner.

Etter inntektsmetoden regnes BNP på følgende måte: Lønn som utbetales til ansatte + bedrifter sin fortjeneste + skatte og avgifter minus subsidier gitt fra staten + avskrivinger knyttet til industri.

```{r}
# Beregne BNP per innbygger(BNPPI) og ganger ut BNP som er oppgitt i millioner 

BNPPI <- PopulasjonLang %>% 
left_join(BNPLang, by = join_by(region, Aar)) %>%
mutate( Innbyggere = as.numeric(Innbyggere), 
BNP = as.numeric(BNP), 
BNPPI = (BNP * 1e6) / Innbyggere, )

  
```

\

```{r}
#Hvor mange observasjoner det er totalt i BNPPI
nrow(BNPPI)

```

\

```{r}
BNPPI %>%
  summarise(across(everything(), ~ sum(is.na(.x))))
```

#I tabbelen over har vi kombinert de to datasettene hentet fra Eurostat.
Vi har da en tabell som viser BNP per inbygger i hvert av NUTS3 områdene for delt på år.
I hver obersvasjon hvor det forekommer en NA verdi i populasjon og eller total BNP vil også få BNPPI som NA verdi.
Datasettet består av totalt 4680 observasjoner, og 841 av dem ender opp ned NA verdi i BNPPI.
For å videre kunne jobbe mer effektivt i utarbeidelsen av tabellene, lager vi et nytt datasett hvor alle observasjoner med NA verdi er fjernet.

```{r}
#Fjerner alle regioner med NA verdier

BNPPIRen <- na.omit(BNPPI)

```

```{r}

# Grupper etter år

BNPPIRen %>%
  mutate(Aar = as.numeric(Aar)) %>%  # Sørger for numerisk år
  group_by(Aar) %>%  
  summarise(
    gjennomsnitt_BNPPI = mean(BNPPI),
    median_BNPPI      = median(BNPPI),
    minste_BNPPI      = min(BNPPI),
    største_BNPPI     = max(BNPPI)
  ) %>%
  arrange(Aar) %>%
  mutate(across(
    gjennomsnitt_BNPPI:største_BNPPI,
    ~ label_number(big.mark = " ")(.)
  )) %>%
  kable()


```

I tabellen over ser vi utviklingen av gjenomsnitt, median, minste og høyeste verdi for BNP per inbygger for fra år 2000 til år 2023.
Verdiene er basert på alle obervasjonene fra datasettet hvor obervasjoner med NA verdier er fjernet.
Videre skal vi lage en deskreptiv analyse utifra statestikken som fremkommer av datasettet.
For å enkelere visualisere dette lager vi linediagramer for sentrale mål.

```{r}
BNPPIRen %>%
  group_by(Aar) %>% 
  summarise(
    Gjennomsnitt = mean(BNPPI, na.rm = TRUE),
    Median = median(BNPPI, na.rm = TRUE)
  ) %>%
  pivot_longer(
    cols = c(Gjennomsnitt, Median),
    names_to = "Statistikk",
    values_to = "BNPPI_verdi"
  ) %>%
  ggplot(aes(x = Aar, y = BNPPI_verdi, color = Statistikk)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  labs(
    title = "Utvikling i BNP per innbygger (gjennomsnitt og median)",
    x = "År",
    y = "BNP per innbygger (BNPPI)",
    color = "Statistikk"
  ) +
  scale_color_manual(values = c("Gjennomsnitt" = "#2E86AB", "Median" = "#A93226")) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    panel.grid.minor = element_blank()
  )
  
```

I tabellen over ser vi utviklingen av gjenomsnitt og median verdien fra år 2000 til 2023.
Begge de statistiske målene følger i stor grad samme utvikling.
Det er en stor økning fra 2000 til 2001.
Etter dette er det i hovedsak en jevn generel vekst fra år til år, med et par avvik.
I både 2008 og 2020 ser vi reduksjon i BNPPI sammenlignet med det forekommende året.
I 2023 ser vi igjen en drastisk endring, spesielt i Median hvor BNPPI reduseres fra ca 25 000 dollar til ca 15 000 dollar.
Reduksjonen i år 2008 og 2020 er ikke overaskende og kan forklares med henholdsvis finanskrisen og Covid-19.

En annen faktor som kan påvirke utviklingen av BNPPI er utartingen av NA verdier i data settet vårt.
Som tidligere vist er det totalt 841 obersvasjoner som ikke kommer med i denne tabellen.
I hvilken år disse fremkommer og hvilken NUTS3 regioner som forsvinner fra disse årene kan forventes å ha en effekt på gjenomsnittet for det året.
Dette kommer av at noen land gjenerelt sett har høyere BNP enn andre.

```{r}
BNPPI %>%
  group_by(Aar) %>%
  summarise(
    antall_NA = sum(is.na(BNPPI)),
    total_obs = n()
  ) %>%
  arrange(Aar) %>%
  kable() %>%
  kable_styling(full_width = FALSE, position = "left")
```

I denne tabellen set vi at i BNPPI datasettet er det 140 observasjoner fra 2000 og 124 fra 2023 som har NA verdier.
Dette skiller seg ut fra årene i mellom hvor det jevnt gjennom er 26 observasjoner med NA verdi.
Totalt er det 195 obervasjoner hvert år.
En teori som kan forklare at median og gjenomsnittsveridene er veldig lave i forhold er at NUTS3 regioner med NA verdier i disse årstallene i hovedsak stammer fra land med relativt høyest BNPPI.

## Part B: Regional ulikhet

Oppsumering av artikkel

## Ginis koeffisient

I 2017 publiserte Christian Lessmann og Andre Seidel en artikkel hvor de ser på hvor godt egnet «lysdata» er til å estimere regional inntekt.
Sentrale spørsmål som tas opp i artikkelen er hvordan regionale økonomiske ulikheter utvikler seg over tid, og hvilke faktorer som fører til endringer i regional ulikhet.
 

I en 2012 artikkel som Lessmann og Seidel er inspirert av presenteres ideen om at «lysdata» er en indikasjon på hvor økonomisk utviklet et land er.
Tankegangen er at aktiviteter som koster penger å gjennomføre på kvelden som regel trenger lys, og jo rikere et land/ region er jo flere har råd til å delta på slike aktiviteter.
Ved å analysere satellitt bilder på nattestid kan mengden lys være en indikator på velstanden i området.

Nytteverdien fra denne vinklingen kommer av at det er stor variasjon på hvor dokumentert regionale ulikheter er fra land til land.
Artikkelen påpeker at tidligere studier på området fokuserer på vel- utviklede nasjoner, da det ikke finnes tilgjengelige gode nok data for mindre utviklete land på regionalt nivå.
Dersom det kan bevises at dette konseptet holder vann får forskere enn ny måte å analysere mindre velstående land sin regionale ulikhet.

For å undersøke hvor valid teorien er, analyserer artikkelen først velstående land hvor det allerede finnes godt dekkende data over regionale ulikheter.
Ved å analysere bilder fra NASA satellitter og rangere regioner fra 1992 og utover, skaper de estimater over hvor mye økonomisk utvikling regioner har hatt i perioden.

I studien brukes Gini-koeffisient.
Dette er et mål som måler hvor skjevt ressurser i en befolkning fordeles, for eksempel mellom regioner.
Gini-koeffisient har en skala fra 0 til 1.
En 0-verdi betyr at alt er likt fordelt, og 1 betyr at alle ressursene ligger hos en eller et veldig få antall personer.
I studien beregnes og måles koeffisienten i regioner over tid, som viser om det er divergens eller konvergens.
Dersom koeffisient øker over tid vil det si at forskjellene mellom de rike og fattige øker over tid, og det er divergens.
Hvis koeffisienten reduseres over tid reduseres forskjellen mellom rik og fattige, dvs konvergens.

Ved å sammenligne estimatene med faktiske BNP data kommer det frem at teorien i stor grad stemmer overens i middels rike og rike land, mens i fattigere land man har data på er konseptet dårlig egnet.
 

## Beregne Gini-koeffisient på vårt datasett

Videre i oppgaven skal vi beregne Gini-koeffisienten på NUTS2 nivå for landene Italia, Finland, Romania og Litauen.
Første steg er å transformere BNNPPIRen datasettet våres for NUTS3 regioner til en oversikt over NUTS2 regioner.
Hver NUTS3 region har en tilhørende "geo" kode.
Disse består av 5 tegn, for eksempel ITC31 for Imperia.
De fire første sympolene er det samme som NUTS 2 geo koden.
Ved å samle alle obervasjoner hvor de firste første sympolene er like kan vi lage en datasett fordelt på NUTS 2 regioner.

```{r}
NUTS2 <- BNPPIRen %>%
  mutate(
    NUTS2 = substr(geo, 1, 4),    # Hent NUTS2-koden fra GEO
    Aar = as.numeric(Aar)          # Sørg for at år er numerisk
  )
```

```{}
```
